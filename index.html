<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Placa App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Slightly darker background for a professional feel */
        }
        /* Custom styles for select arrow */
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: none; /* Remove default arrow */
        }
        select::-ms-expand {
            display: none; /* Hide arrow in IE/Edge */
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e0e0e0;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <script type="text/javascript">
        console.log("Script principal come√ßando a carregar.");
        // Manual SVG Icons from Lucide React
        const icons = {
            FileText: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-text"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L15 2z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>',
            PlusCircle: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus-circle"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>',
            Search: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>',
            Building: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-building"><rect width="16" height="20" x="4" y="2" rx="2" ry="2"/><path d="M9 22v-4h6v4"/><path d="M8 6h.01"/><path d="M16 6h.01"/><path d="M12 6h.01"/><path d="M12 10h.01"/><path d="M12 14h.01"/><path d="M12 18h.01"/></svg>',
            Truck: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-truck"><path d="M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2"/><path d="M19 18h2a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-1V6a2 2 0 0 0-2-2h-3a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2"/><circle cx="7" cy="18" r="2"/><circle cx="17" cy="18" r="2"/></svg>',
            UserCheck: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-check"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><polyline points="22 7 18 11 16 9"/></svg>',
            LogOut: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-out"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="17 16 22 12 17 8"/><line x1="22" x2="11" y1="12" y2="12"/></svg>',
            Trash2: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>',
            Menu: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>',
            X: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>',
            ChevronDown: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down"><path d="m6 9 6 6 6-6"/></svg>',
            ChevronUp: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-up"><path d="m18 15-6-6-6 6"/></svg>',
            LayoutDashboard: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layout-dashboard"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>',
            CalendarDays: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-days"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></svg>',
            User: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>',
            Users: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>',
            Settings: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-settings"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.78 1.28a2 2 0 0 0 .73 2.73l.04.02a2 2 0 0 1 .97 1.95v.44a2 2 0 0 1-.97 1.95l-.04.02a2 2 0 0 0-.73 2.73l.78 1.28a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.78-1.28a2 2 0 0 0-.73-2.73l-.04-.02a2 2 0 0 1-.97-1.95v-.44a2 2 0 0 1 .97-1.95l.04-.02a2 2 0 0 0 .73-2.73l-.78-1.28a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>',
            ArrowLeftRight: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucude-arrow-left-right"><path d="M8 3L4 7L8 11"/><path d="M4 7h16"/><path d="M16 21l4-4l-4-4"/><path d="M20 17H4"/></svg>',
            ArrowLeft: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>',
            MapPin: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin"><path d="M12 18.3a3.3 3.3 0 1 0 0-6.6 3.3 3.3 0 0 0 0 6.6z"/><path d="M12 2C7.58 2 4 5.58 4 10c0 5.57 8 12 8 12s8-6.43 8-12c0-4.42-3.58-8-8-8z"/></svg>',
            //Factory: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-factory"><path d="M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 9.86 2H7.14a2 2 0 0 0-1.66.9l-.82 1.2A2 2 0 0 1 4 6H2v14z"/><path d="M10 10v4"/><path d="M14 10v4"/><path d="M18 10v4"/><path d="M6 10v4"/></svg>'
        };
        // Helper function to render Lucide icons
        function LucideIcon({ name, className }) {
            return React.createElement('span', {
                className: className,
                dangerouslySetInnerHTML: { __html: icons[name] || '' }
            });
        }

        // Componente de Mensagem/Toast
        function Toast({ message, type, onClose }) {
            const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
            const icon = type === 'success' ? '‚úî' : '‚úñ'; // Simple icons for now

            React.useEffect(() => {
                const timer = setTimeout(() => {
                    onClose();
                }, 3000); // Auto-close after 3 seconds
                return () => clearTimeout(timer);
            }, [onClose]);
            return (
                React.createElement('div', { className: `fixed bottom-4 right-4 ${bgColor} text-white p-4 rounded-lg shadow-lg flex items-center space-x-2 z-50 transition-all duration-300 ease-in-out transform translate-y-0 opacity-100` },
                    React.createElement('span', { className: "font-bold text-xl" }, icon),
                    React.createElement('p', null, message),
                    React.createElement('button', { onClick: onClose, className: "ml-4 font-bold opacity-75 hover:opacity-100 transition-opacity" }, 'X')
                )
            );
        }

        // Componente de Confirma√ß√£o Modal
        function ConfirmationModal({ message, onConfirm, onCancel }) {
            return (
                React.createElement('div', { className: "fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 animate-fade-in" },
                    React.createElement('div', { className: "bg-white p-8 rounded-xl shadow-2xl max-w-sm w-full text-center transform scale-95 animate-scale-in" },
                        React.createElement('p', { className: "text-lg font-semibold text-gray-800 mb-6" }, message),
                        React.createElement('div', { className: "flex justify-center space-x-4" },
                            React.createElement('button', {
                                onClick: onConfirm,
                                className: "px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition duration-300 ease-in-out transform hover:scale-105 shadow-md"
                            }, "Confirmar"),
                            React.createElement('button', {
                                onClick: onCancel,
                                className: "px-6 py-3 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition duration-300 ease-in-out transform hover:scale-105 shadow-md"
                            }, "Cancelar")
                        )
                    )
                )
            );
        }


        // Wrap the entire React app rendering logic within window.onload
        window.onload = function() {
            console.log("window.onload disparado.");
            // Supabase client initialization
            const SUPABASE_URL = 'https://gfivmnnysomfwrffybeh.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdmaXZtbm55c29tZndyZmZ5YmVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMyOTY3NjgsImV4cCI6MjA2ODg3Mjc2OH0.NxetXJoCLh4q9zAqn_olimziI3YP4MAJzB8ed4qf8cg';

            let supabase;

            // Function to initialize Supabase and render the App
            const initializeSupabaseAndRenderApp = () => {
                try {
                    console.log("Tentando inicializar o cliente Supabase...");
                    // Corrected: Use 'supabase' (lowercase) as the global object
                    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    console.log("Cliente Supabase inicializado com sucesso.");
                    ReactDOM.render(React.createElement(App, null), document.getElementById('root'));
                } catch (e) {
                    console.error("Erro ao inicializar o cliente Supabase:", e);
                    ReactDOM.render(
                        React.createElement('div', { style: { textAlign: 'center', padding: '20px', color: 'red' } },
                            React.createElement('h1', null, 'Erro ao Inicializar Supabase'),
                            React.createElement('p', null, `Ocorreu um erro ao inicializar o cliente Supabase: ${e.message}. Verifique as suas credenciais e a configura√ß√£o do projeto Supabase.`)
                        ),
                        document.getElementById('root')
                    );
                }
            };
            // Dynamically load Supabase library
            const supabaseScript = document.createElement('script');
            supabaseScript.src = "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.43.0/dist/umd/supabase.min.js";
            supabaseScript.onload = () => {
                console.log("Biblioteca Supabase carregada com sucesso.");
                initializeSupabaseAndRenderApp();
            };
            supabaseScript.onerror = (error) => {
                console.error("Erro ao carregar a biblioteca Supabase:", error);
                ReactDOM.render(
                    React.createElement('div', { style: { textAlign: 'center', padding: '20px', color: 'red' } },
                        React.createElement('h1', null, 'Erro ao Carregar Aplica√ß√£o'),
                        React.createElement('p', null, 'A biblioteca Supabase n√£o foi carregada. Por favor, verifique a sua liga√ß√£o √† internet ou o link CDN do Supabase no c√≥digo HTML.')
                    ),
                    document.getElementById('root')
                );
            };
            document.head.appendChild(supabaseScript);


            // Global variable for app ID (from Canvas environment, if applicable, otherwise default)
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

            // Componente para a tela de Login
            function LoginPage({ onLogin }) {
              const [username, setUsername] = React.useState('');
              const [password, setPassword] = React.useState('');
              const [error, setError] = React.useState('');
              const [isLoggingIn, setIsLoggingIn] = React.useState(false);
              const handleLogin = async (e) => {
                e.preventDefault();
                setIsLoggingIn(true);
                setError('');

                if (!username || !password) {
                  setError('Por favor, insira seu usu√°rio e senha.');
                  setIsLoggingIn(false);
                  return;
                }

                await new Promise(resolve => setTimeout(resolve, 1000));
                let role = null;

                // Special login for 'admin' user with fixed password
                if (username.toLowerCase() === 'admin' && password === '1234') {
                  role = 'administrador';
                } else {
                  try {
                    // Query the public app_users table for authentication for other users
                    const { data, error: fetchError } = await supabase
                      .from('app_users') // Supabase table name
                      .select('*')
                      .eq('username', username.toLowerCase())
                      .eq('password', password); // IMPORTANT: In production, hash passwords!

                    if (fetchError) throw fetchError;
                    if (data && data.length > 0) {
                      role = data[0].role;
                    }
                  } catch (e) {
                    console.error("Erro ao buscar usu√°rio no Supabase:", e);
                    setError("Erro ao autenticar. Por favor, tente novamente.");
                  }
                }

                if (role) {
                  onLogin(role, username); // Pass username as userId for data partitioning
                } else {
                  setError('Usu√°rio ou senha inv√°lidos.');
                }
                setIsLoggingIn(false);
              };
              return (
                React.createElement('div', { className: "flex items-center justify-center min-h-screen bg-gray-100 font-sans" },
                  React.createElement('div', { className: "bg-white p-8 rounded-xl shadow-lg w-full max-w-md" },
                    // TERC SISTEMAS title
                    React.createElement('div', { className: "flex flex-col items-center justify-center mb-6" },
                        React.createElement('h2', { className: "text-4xl font-extrabold text-blue-600 text-center" }, "TERC SISTEMAS")
                        // Description removed from here
                    ),
                    error && (
                      React.createElement('div', { className: "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4", role: "alert" },
                        React.createElement('strong', { className: "font-bold" }, "Erro:"),
                        React.createElement('span', { className: "block sm:inline" }, " ", error)
                      )
                    ),
                    React.createElement('form', { onSubmit: handleLogin },
                      React.createElement('div', { className: "mb-4" },
                        React.createElement('label', { htmlFor: "username", className: "block text-sm font-medium text-gray-700 mb-1" }, "Usu√°rio"),
                        React.createElement('input', {
                          type: "text",
                          id: "username",
                          value: username,
                          onChange: (e) => { setUsername(e.target.value); setError(''); },
                          className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                          placeholder: "Digite seu usu√°rio",
                          required: true,
                          disabled: isLoggingIn
                        })
                      ),
                      React.createElement('div', { className: "mb-6" },
                        React.createElement('label', { htmlFor: "password", className: "block text-sm font-medium text-gray-700 mb-1" }, "Senha"),
                        React.createElement('input', {
                          type: "password",
                          id: "password",
                          value: password,
                          onChange: (e) => setPassword(e.target.value),
                          className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                          placeholder: "Digite sua senha",
                          required: true,
                          disabled: isLoggingIn
                        })
                      ),
                      React.createElement('button', {
                        type: "submit",
                        className: "w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
                        disabled: isLoggingIn
                      },
                      isLoggingIn ? (
                          React.createElement('svg', { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" },
                            React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r="10", stroke: "currentColor", strokeWidth="4" }),
                            React.createElement('path', { className: "opacity-75", fill: "currentColor", d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
                          )
                        ) : (
                          React.createElement(LucideIcon, { name: "UserCheck", className: "mr-2 h-5 w-5" })
                        ),
                        isLoggingIn ? 'Entrando...' : 'Entrar'
                      )
                    )
                  )
                )
              );
            }

            // Componente para Gerenciamento de Filiais
            function BranchManagement({ userId, showToast }) {
              const [newBranchName, setNewBranchName] = React.useState('');
              const [branches, setBranches] = React.useState([]);
              const [error, setError] = React.useState(null);
              const [isLoading, setIsLoading] = React.useState(false);
              const [showConfirmModal, setShowConfirmModal] = React.useState(false);
              const [branchToDelete, setBranchToDelete] = React.useState(null);


              React.useEffect(() => {
                if (!userId) return;
                const fetchBranches = async () => {
                  setIsLoading(true);
                  const { data, error: fetchError } = await supabase
                    .from('filiais')
                    .select('*')
                    .eq('created_by_username', userId)
                    .order('created_at', { ascending: false });

                  if (fetchError) {
                    console.error("Erro ao buscar filiais no Supabase:", fetchError);
                    setError("Erro ao carregar filiais. Por favor, recarregue a p√°gina.");
                    showToast("Erro ao carregar filiais.", "error");
                  } else {
                    setBranches(data);
                    setError(null);
                  }
                  setIsLoading(false);
                };
                fetchBranches();
              }, [userId, showToast]);
              const handleAddBranch = async (e) => {
                e.preventDefault();
                if (!newBranchName.trim()) {
                  setError("O nome da filial n√£o pode estar vazio.");
                  showToast("O nome da filial n√£o pode estar vazio.", "error");
                  return;
                }
                setIsLoading(true);
                try {
                  const { error: insertError } = await supabase
                    .from('filiais')
                    .insert([
                      { name: newBranchName.trim(), created_by_username: userId }
                    ]);

                  if (insertError) throw insertError;

                  setNewBranchName('');
                  setError(null);
                  showToast("Filial adicionada com sucesso!", "success");
                  // Re-fetch data to update the list
                  const { data, error: fetchError } = await supabase
                    .from('filiais')
                    .select('*')
                    .eq('created_by_username', userId)
                    .order('created_at', { ascending: false });
                  if (fetchError) console.error("Erro ao re-buscar filiais:", fetchError);
                  else setBranches(data);

                } catch (e) {
                  console.error("Erro ao adicionar filial:", e);
                  setError("Erro ao adicionar filial. Tente novamente.");
                  showToast("Erro ao adicionar filial.", "error");
                }
                setIsLoading(false);
              };
              const confirmDeleteBranch = (branch) => {
                setBranchToDelete(branch);
                setShowConfirmModal(true);
              };

              const handleDeleteBranch = async () => {
                if (!branchToDelete) return;
                setIsLoading(true);
                setShowConfirmModal(false); // Close modal
                try {
                  const { error: deleteError } = await supabase
                    .from('filiais')
                    .delete()
                    .eq('id', branchToDelete.id);

                  if (deleteError) throw deleteError;

                  showToast("Filial exclu√≠da com sucesso!", "success");
                  // Re-fetch data to update the list
                  const { data, error: fetchError } = await supabase
                    .from('filiais')
                    .select('*')
                    .eq('created_by_username', userId)
                    .order('created_at', { ascending: false });
                  if (fetchError) console.error("Erro ao re-buscar filiais:", fetchError);
                  else setBranches(data);

                } catch (e) {
                  console.error("Erro ao deletar filial:", e);
                  setError("Erro ao deletar filial. Tente novamente.");
                  showToast("Erro ao excluir filial.", "error");
                } finally {
                    setIsLoading(false);
                    setBranchToDelete(null);
                }
              };
              return (
                React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg" },
                  React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-4 text-center" }, "Cadastro de Filiais"),
                  error && (
                    React.createElement('div', { className: "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4", role: "alert" },
                      React.createElement('strong', { className: "font-bold" }, "Erro:"),
                      React.createElement('span', { className: "block sm:inline" }, " ", error)
                    )
                  ),
                  React.createElement('form', { onSubmit: handleAddBranch, className: "flex flex-col sm:flex-row gap-4 mb-6" },
                    React.createElement('input', {
                      type: "text",
                      value: newBranchName,
                      onChange: (e) => setNewBranchName(e.target.value),
                      className: "flex-grow mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                      placeholder: "Nome da nova filial",
                      required: true,
                      disabled: isLoading
                    }),
                    React.createElement('button', {
                      type: "submit",
                      className: "inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
                      disabled: isLoading
                    },
                    isLoading ? (
                        React.createElement('svg', { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" },
                          React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r="10", stroke: "currentColor", strokeWidth="4" }),
                          React.createElement('path', { className: "opacity-75", fill: "currentColor", d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
                        )
                      ) : (
                        React.createElement(LucideIcon, { name: "PlusCircle", className: "mr-2 h-5 w-5" })
                      ),
                      isLoading ? 'Adicionando...' : 'Adicionar Filial'
                    )
                  ),
                  React.createElement('div', { className: "overflow-x-auto rounded-lg shadow-md border border-gray-200" },
                    React.createElement('table', { className: "min-w-full divide-y divide-gray-200" },
                      React.createElement('thead', { className: "bg-gray-100" },
                        React.createElement('tr', null,
                          React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Filial"),
                          React.createElement('th', { scope: "col", className: "px-6 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider" }, "A√ß√µes")
                        )
                      ),
                      React.createElement('tbody', { className: "bg-white divide-y divide-gray-200" },
                        isLoading && branches.length === 0 ? (
                          React.createElement('tr', null,
                            React.createElement('td', { colSpan: "2", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Carregando filiais...")
                          )
                        ) : branches.length === 0 ? (
                          React.createElement('tr', null,
                            React.createElement('td', { colSpan: "2", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Nenhuma filial cadastrada.")
                          )
                        ) : (
                          branches.map((branch) => (
                            React.createElement('tr', { key: branch.id, className: "hover:bg-gray-50 transition-colors duration-150" },
                              React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" }, branch.name),
                              React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-right text-sm font-medium" },
                                React.createElement('button', { onClick: () => confirmDeleteBranch(branch), className: "text-red-600 hover:text-red-800 ml-4 transition-colors duration-150", title: "Excluir Filial", disabled: isLoading },
                                  React.createElement(LucideIcon, { name: "Trash2", className: "h-5 w-5" })
                                )
                              )
                            )
                          ))
                        )
                      )
                    )
                  ),
                  showConfirmModal && React.createElement(ConfirmationModal, { message: `Tem certeza que deseja excluir a filial "${branchToDelete?.name}"?`,
                  onConfirm: handleDeleteBranch, onCancel: () => setShowConfirmModal(false) })
                )
              );
            }
            // Componente para Gerenciamento de Equipamentos
            function EquipmentManagement({ userId, showToast }) {
              const [newPlate, setNewPlate] = React.useState('');
              const [newEquipmentType, setNewEquipmentType] = React.useState('');
              const [equipmentList, setEquipmentList] = React.useState([]);
              const [error, setError] = React.useState(null);
              const [isLoading, setIsLoading] = React.useState(false);
              const [showConfirmModal, setShowConfirmModal] = React.useState(false);
              const [equipmentToDelete, setEquipmentToDelete] = React.useState(null);
              const equipmentTypes = ["BOMBA LAN√áA", "BOMBA", "BETONEIRA"];
              React.useEffect(() => {
                if (!userId) return;
                const fetchEquipment = async () => {
                  setIsLoading(true);
                  const { data, error: fetchError } = await supabase
                    .from('equipamentos')
                    .select('*')
                    .eq('created_by_username', userId)
                    .order('created_at', { ascending: false });
                  if (fetchError) {
                    console.error("Erro ao buscar equipamentos no Supabase:", fetchError);
                    setError("Erro ao carregar equipamentos. Por favor, recarregue a p√°gina.");
                    showToast("Erro ao carregar equipamentos.", "error");
                  } else {
                    setEquipmentList(data);
                    setError(null);
                  }
                  setIsLoading(false);
                };
                fetchEquipment();
              }, [userId, showToast]);
              const handleAddEquipment = async (e) => {
                e.preventDefault();
                if (!newPlate.trim() || !newEquipmentType) {
                  setError("Por favor, preencha a placa e selecione o tipo de equipamento.");
                  showToast("Preencha todos os campos.", "error");
                  return;
                }
                setIsLoading(true);
                try {
                  const { error: insertError } = await supabase
                    .from('equipamentos')
                    .insert([
                      { plate: newPlate.trim(), type: newEquipmentType, created_by_username: userId }
                    ]);
                  if (insertError) throw insertError;
                  setNewPlate('');
                  setNewEquipmentType('');
                  setError(null);
                  showToast("Equipamento adicionado com sucesso!", "success");
                  // Re-fetch data
                  const { data, error: fetchError } = await supabase
                    .from('equipamentos')
                    .select('*')
                    .eq('created_by_username', userId)
                    .order('created_at', { ascending: false });
                  if (fetchError) console.error("Erro ao re-buscar equipamentos:", fetchError);
                  else setEquipmentList(data);
                } catch (e) {
                  console.error("Erro ao adicionar equipamento:", e);
                  setError("Erro ao adicionar equipamento. Tente novamente.");
                  showToast("Erro ao adicionar equipamento.", "error");
                }
                setIsLoading(false);
              };
              const confirmDeleteEquipment = (equipment) => {
                setEquipmentToDelete(equipment);
                setShowConfirmModal(true);
              };
              const handleDeleteEquipment = async () => {
                if (!equipmentToDelete) return;
                setIsLoading(true);
                setShowConfirmModal(false); // Close modal
                try {
                  const { error: deleteError } = await supabase
                    .from('equipamentos')
                    .delete()
                    .eq('id', equipmentToDelete.id);
                  if (deleteError) throw deleteError;
                  showToast("Equipamento exclu√≠do com sucesso!", "success");
                  // Re-fetch data
                  const { data, error: fetchError } = await supabase
                    .from('equipamentos')
                    .select('*')
                    .eq('created_by_username', userId)
                    .order('created_at', { ascending: false });
                  if (fetchError) console.error("Erro ao re-buscar equipamentos:", fetchError);
                  else setEquipmentList(data);
                } catch (e) {
                  console.error("Erro ao deletar equipamento:", e);
                  setError("Erro ao deletar equipamento. Tente novamente.");
                  showToast("Erro ao excluir equipamento.", "error");
                } finally {
                    setIsLoading(false);
                    setEquipmentToDelete(null);
                }
              };
              return (
                React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg" },
                  React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-4 text-center" }, "Cadastro de Equipamentos"),
                  error && (
                    React.createElement('div', { className: "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4", role: "alert" },
                      React.createElement('strong', { className: "font-bold" }, "Erro:"),
                      React.createElement('span', { className: "block sm:inline" }, " ", error)
                    )
                  ),
                  React.createElement('form', { onSubmit: handleAddEquipment, className: "grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 items-end" },
                    React.createElement('div', null,
                      React.createElement('label', { htmlFor: "plate", className: "block text-sm font-medium text-gray-700 mb-1" }, "Placa"),
                      React.createElement('input', {
                        type: "text",
                        id: "plate",
                        value: newPlate,
                        onChange: (e) => setNewPlate(e.target.value),
                        className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                        placeholder: "Ex: ABC1234",
                        required: true,
                        disabled: isLoading
                      })
                    ),
                    React.createElement('div', null,
                      React.createElement('label', { htmlFor: "equipment-type", className: "block text-sm font-medium text-gray-700 mb-1" }, "Tipo de Equipamento"),
                      React.createElement('div', { className: "relative" },
                        React.createElement('select', {
                          id: "equipment-type",
                          value: newEquipmentType,
                          onChange: (e) => setNewEquipmentType(e.target.value),
                          className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm pr-10 transition duration-150 ease-in-out",
                          required: true,
                          disabled: isLoading
                        },
                          React.createElement('option', { value: "" }, "Selecione o Tipo"),
                          equipmentTypes.map(type => (
                            React.createElement('option', { key: type, value: type }, type)
                          ))
                        ),
                        React.createElement(LucideIcon, { name: "ChevronDown", className: "absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none" })
                      )
                    ),
                    React.createElement('button', {
                      type: "submit",
                      className: "inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105 sm:mt-0",
                      disabled: isLoading
                    },
                    isLoading ? (
                        React.createElement('svg', { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" },
                          React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r="10", stroke: "currentColor", strokeWidth="4" }),
                          React.createElement('path', { className: "opacity-75", fill: "currentColor", d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
                        )
                      ) : (
                        React.createElement(LucideIcon, { name: "PlusCircle", className: "mr-2 h-5 w-5" })
                      ),
                      isLoading ? 'Adicionando...' : 'Adicionar Equipamento'
                    )
                  ),
                  React.createElement('div', { className: "overflow-x-auto rounded-lg shadow-md border border-gray-200" },
                    React.createElement('table', { className: "min-w-full divide-y divide-gray-200" },
                      React.createElement('thead', { className: "bg-gray-100" },
                        React.createElement('tr', null,
                          React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Placa"),
                          React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Tipo"),
                          React.createElement('th', { scope: "col", className: "px-6 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider" }, "A√ß√µes")
                        )
                      ),
                      React.createElement('tbody', { className: "bg-white divide-y divide-gray-200" },
                        isLoading && equipmentList.length === 0 ? (
                          React.createElement('tr', null,
                            React.createElement('td', { colSpan: "3", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Carregando equipamentos...")
                          )
                        ) : equipmentList.length === 0 ? (
                          React.createElement('tr', null,
                            React.createElement('td', { colSpan: "3", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Nenhum equipamento cadastrado.")
                          )
                        ) : (
                          equipmentList.map((equipment) => (
                            React.createElement('tr', { key: equipment.id, className: "hover:bg-gray-50 transition-colors duration-150" },
                              React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" }, equipment.plate),
                              React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" }, equipment.type),
                              React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-right text-sm font-medium" },
                                React.createElement('button', { onClick: () => confirmDeleteEquipment(equipment), className: "text-red-600 hover:text-red-800 ml-4 transition-colors duration-150", title: "Excluir Equipamento", disabled: isLoading },
                                  React.createElement(LucideIcon, { name: "Trash2", className: "h-5 w-5" })
                                )
                              )
                            )
                          ))
                        )
                      )
                    )
                  ),
                  showConfirmModal && React.createElement(ConfirmationModal, { message: `Tem certeza que deseja excluir o equipamento de placa "${equipmentToDelete?.plate}"?`,
                  onConfirm: handleDeleteEquipment, onCancel: () => setShowConfirmModal(false) })
                )
              );
            }

            // Componente para Gerenciamento de Usu√°rios (Apenas Admin)
            function UserManagement({ showToast }) {
                const [users, setUsers] = React.useState([]);
                const [newUser, setNewUser] = React.useState({ username: '', password: '', role: 'usuario' });
                const [editingUser, setEditingUser] = React.useState(null);
                const [error, setError] = React.useState(null);
                const [isLoading, setIsLoading] = React.useState(false);
                const [showConfirmModal, setShowConfirmModal] = React.useState(false);
                const [userToDelete, setUserToDelete] = React.useState(null);

                React.useEffect(() => {
                    fetchUsers();
                }, []);

                const fetchUsers = async () => {
                    setIsLoading(true);
                    const { data, error: fetchError } = await supabase
                        .from('app_users')
                        .select('*')
                        .order('created_at', { ascending: false });

                    if (fetchError) {
                        console.error("Erro ao buscar usu√°rios:", fetchError);
                        setError("Erro ao carregar usu√°rios.");
                        showToast("Erro ao carregar usu√°rios.", "error");
                    } else {
                        setUsers(data);
                    }
                    setIsLoading(false);
                };

                const handleAddOrUpdateUser = async (e) => {
                    e.preventDefault();
                    if (!newUser.username.trim() || !newUser.password.trim() || !newUser.role.trim()) {
                        setError("Todos os campos s√£o obrigat√≥rios.");
                        showToast("Todos os campos s√£o obrigat√≥rios.", "error");
                        return;
                    }
                    setIsLoading(true);
                    setError(null);

                    try {
                        if (editingUser) {
                            // Update user
                            const { error: updateError } = await supabase
                                .from('app_users')
                                .update({ username: newUser.username.toLowerCase(), password: newUser.password, role: newUser.role })
                                .eq('id', editingUser.id);
                            if (updateError) throw updateError;
                            showToast("Usu√°rio atualizado com sucesso!", "success");
                        } else {
                            // Add new user
                            const { error: insertError } = await supabase
                                .from('app_users')
                                .insert([
                                    { username: newUser.username.toLowerCase(), password: newUser.password, role: newUser.role }
                                ]);
                            if (insertError) throw insertError;
                            showToast("Usu√°rio adicionado com sucesso!", "success");
                        }
                        setNewUser({ username: '', password: '', role: 'usuario' });
                        setEditingUser(null);
                        fetchUsers(); // Refresh the list
                    } catch (e) {
                        console.error("Erro ao salvar usu√°rio:", e);
                        setError(`Erro ao salvar usu√°rio: ${e.message}`);
                        showToast(`Erro ao salvar usu√°rio.`, "error");
                    } finally {
                        setIsLoading(false);
                    }
                };

                const confirmDeleteUser = (user) => {
                    setUserToDelete(user);
                    setShowConfirmModal(true);
                };

                const handleDeleteUser = async () => {
                    if (!userToDelete) return;
                    setIsLoading(true);
                    setShowConfirmModal(false); // Close modal
                    try {
                        const { error: deleteError } = await supabase
                            .from('app_users')
                            .delete()
                            .eq('id', userToDelete.id);
                        if (deleteError) throw deleteError;
                        showToast("Usu√°rio exclu√≠do com sucesso!", "success");
                        fetchUsers(); // Refresh the list
                    } catch (e) {
                        console.error("Erro ao deletar usu√°rio:", e);
                        setError("Erro ao deletar usu√°rio.");
                        showToast("Erro ao excluir usu√°rio.", "error");
                    } finally {
                        setIsLoading(false);
                        setUserToDelete(null);
                    }
                };

                const handleEditClick = (user) => {
                    setNewUser({ username: user.username, password: user.password, role: user.role });
                    setEditingUser(user);
                };

                const handleCancelEdit = () => {
                    setNewUser({ username: '', password: '', role: 'usuario' });
                    setEditingUser(null);
                    setError(null);
                };

                return (
                    React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg" },
                        React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-4 text-center" }, "Gerenciamento de Usu√°rios"),
                        error && (
                            React.createElement('div', { className: "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4", role: "alert" },
                                React.createElement('strong', { className: "font-bold" }, "Erro:"),
                                React.createElement('span', { className: "block sm:inline" }, " ", error)
                            )
                        ),
                        React.createElement('form', { onSubmit: handleAddOrUpdateUser, className: "grid grid-cols-1 md:grid-cols-4 gap-4 mb-6 items-end" },
                            React.createElement('div', null,
                                React.createElement('label', { htmlFor: "new-username", className: "block text-sm font-medium text-gray-700 mb-1" }, "Usu√°rio"),
                                React.createElement('input', {
                                    type: "text",
                                    id: "new-username",
                                    value: newUser.username,
                                    onChange: (e) => setNewUser({ ...newUser, username: e.target.value }),
                                    className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                                    placeholder: "Nome de usu√°rio",
                                    required: true,
                                    disabled: isLoading
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { htmlFor: "new-password", className: "block text-sm font-medium text-gray-700 mb-1" }, "Senha"),
                                React.createElement('input', {
                                    type: "password",
                                    id: "new-password",
                                    value: newUser.password,
                                    onChange: (e) => setNewUser({ ...newUser, password: e.target.value }),
                                    className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                                    placeholder: "Senha",
                                    required: true,
                                    disabled: isLoading
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { htmlFor: "new-role", className: "block text-sm font-medium text-gray-700 mb-1" }, "Fun√ß√£o"),
                                React.createElement('div', { className: "relative" },
                                    React.createElement('select', {
                                        id: "new-role",
                                        value: newUser.role,
                                        onChange: (e) => setNewUser({ ...newUser, role: e.target.value }),
                                        className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm pr-10 transition duration-150 ease-in-out",
                                        required: true,
                                        disabled: isLoading
                                    },
                                        React.createElement('option', { value: "usuario" }, "Usu√°rio"),
                                        React.createElement('option', { value: "administrador" }, "Administrador")
                                    ),
                                    React.createElement(LucideIcon, { name: "ChevronDown", className: "absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none" })
                                )
                            ),
                            React.createElement('div', { className: "flex space-x-2 md:col-span-1" },
                                React.createElement('button', {
                                    type: "submit",
                                    className: `inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white ${editingUser ? 'bg-orange-500 hover:bg-orange-600 focus:ring-orange-500' : 'bg-blue-600 hover:bg-blue-700 focus:ring-blue-500'} focus:outline-none focus:ring-2 focus:ring-offset-2 transition duration-150 ease-in-out transform hover:scale-105`,
                                    disabled: isLoading
                                },
                                    isLoading ? (
                                        React.createElement('svg', { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" },
                                            React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r="10", stroke: "currentColor", strokeWidth="4" }),
                                            React.createElement('path', { className: "opacity-75", fill: "currentColor", d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
                                        )
                                    ) : (
                                        React.createElement(LucideIcon, { name: editingUser ? "FileText" : "PlusCircle", className: "mr-2 h-5 w-5" })
                                    ),
                                    editingUser ? 'Atualizar' : 'Adicionar Usu√°rio'
                                ),
                                editingUser && React.createElement('button', {
                                    type: "button",
                                    onClick: handleCancelEdit,
                                    className: "inline-flex items-center justify-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
                                    disabled: isLoading
                                }, "Cancelar")
                            )
                        ),
                        React.createElement('div', { className: "overflow-x-auto rounded-lg shadow-md border border-gray-200" },
                            React.createElement('table', { className: "min-w-full divide-y divide-gray-200" },
                                React.createElement('thead', { className: "bg-gray-100" },
                                    React.createElement('tr', null,
                                        React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Usu√°rio"),
                                        React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Fun√ß√£o"),
                                        React.createElement('th', { scope: "col", className: "px-6 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider" }, "A√ß√µes")
                                    )
                                ),
                                React.createElement('tbody', { className: "bg-white divide-y divide-gray-200" },
                                    isLoading && users.length === 0 ? (
                                        React.createElement('tr', null,
                                            React.createElement('td', { colSpan: "3", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Carregando usu√°rios...")
                                        )
                                    ) : users.length === 0 ? (
                                        React.createElement('tr', null,
                                            React.createElement('td', { colSpan: "3", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Nenhum usu√°rio cadastrado.")
                                        )
                                    ) : (
                                        users.filter(user => user.username !== 'admin').map((user) => ( // Hide 'admin' user from the list
                                            React.createElement('tr', { key: user.id, className: "hover:bg-gray-50 transition-colors duration-150" },
                                                React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" }, user.username),
                                                React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" }, user.role),
                                                React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-right text-sm font-medium" },
                                                    React.createElement('button', { onClick: () => handleEditClick(user), className: "text-blue-600 hover:text-blue-800 transition-colors duration-150", title: "Editar Usu√°rio", disabled: isLoading },
                                                        React.createElement(LucideIcon, { name: "FileText", className: "h-5 w-5" })
                                                    ),
                                                    React.createElement('button', { onClick: () => confirmDeleteUser(user), className: "text-red-600 hover:text-red-800 ml-4 transition-colors duration-150", title: "Excluir Usu√°rio", disabled: isLoading },
                                                        React.createElement(LucideIcon, { name: "Trash2", className: "h-5 w-5" })
                                                    )
                                                )
                                            )
                                        ))
                                    )
                                )
                            )
                        ),
                        showConfirmModal && React.createElement(ConfirmationModal, { message: `Tem certeza que deseja excluir o usu√°rio "${userToDelete?.username}"?`,
                        onConfirm: handleDeleteUser, onCancel: () => setShowConfirmModal(false) })
                    )
                );
            }

            // Componente de Gerenciamento de KM/Viagens
            function TravelManagement({ userId, showToast }) {
                const [travels, setTravels] = React.useState([]);
                const [newTravel, setNewTravel] = React.useState({ date: '', plate: '', km: '', branch_id: '' });
                const [branches, setBranches] = React.useState([]);
                const [equipments, setEquipments] = React.useState([]);
                const [error, setError] = React.useState(null);
                const [isLoading, setIsLoading] = React.useState(false);
                const [showConfirmModal, setShowConfirmModal] = React.useState(false);
                const [travelToDelete, setTravelToDelete] = React.useState(null);
                const [editingTravel, setEditingTravel] = React.useState(null);

                React.useEffect(() => {
                    if (!userId) return;
                    fetchData();
                }, [userId]);

                const fetchData = async () => {
                    setIsLoading(true);
                    setError(null);

                    const { data: branchesData, error: branchesError } = await supabase
                        .from('filiais')
                        .select('id, name')
                        .eq('created_by_username', userId)
                        .order('name', { ascending: true });

                    const { data: equipmentsData, error: equipmentsError } = await supabase
                        .from('equipamentos')
                        .select('id, plate')
                        .eq('created_by_username', userId)
                        .order('plate', { ascending: true });

                    const { data: travelsData, error: travelsError } = await supabase
                        .from('travels')
                        .select(`
                            *,
                            filiais (name),
                            equipamentos (plate, type)
                        `)
                        .eq('created_by_username', userId)
                        .order('date', { ascending: false });

                    if (branchesError) {
                        console.error("Erro ao buscar filiais:", branchesError);
                        setError("Erro ao carregar filiais.");
                        showToast("Erro ao carregar filiais.", "error");
                    } else {
                        setBranches(branchesData);
                    }

                    if (equipmentsError) {
                        console.error("Erro ao buscar equipamentos:", equipmentsError);
                        setError("Erro ao carregar equipamentos.");
                        showToast("Erro ao carregar equipamentos.", "error");
                    } else {
                        setEquipments(equipmentsData);
                    }

                    if (travelsError) {
                        console.error("Erro ao buscar viagens:", travelsError);
                        setError("Erro ao carregar viagens.");
                        showToast("Erro ao carregar viagens.", "error");
                    } else {
                        setTravels(travelsData);
                    }

                    setIsLoading(false);
                };

                const handleAddOrUpdateTravel = async (e) => {
                    e.preventDefault();
                    if (!newTravel.date || !newTravel.plate || !newTravel.km || !newTravel.branch_id) {
                        setError("Todos os campos s√£o obrigat√≥rios.");
                        showToast("Por favor, preencha todos os campos.", "error");
                        return;
                    }

                    const selectedEquipment = equipments.find(eq => eq.plate === newTravel.plate);
                    if (!selectedEquipment) {
                        setError("Placa de equipamento inv√°lida.");
                        showToast("Placa de equipamento inv√°lida.", "error");
                        return;
                    }

                    setIsLoading(true);
                    setError(null);

                    try {
                        const payload = {
                            date: newTravel.date,
                            plate: newTravel.plate,
                            km: parseFloat(newTravel.km),
                            branch_id: newTravel.branch_id,
                            equipment_id: selectedEquipment.id,
                            created_by_username: userId
                        };

                        if (editingTravel) {
                            // Update existing travel
                            const { error: updateError } = await supabase
                                .from('travels')
                                .update(payload)
                                .eq('id', editingTravel.id);
                            if (updateError) throw updateError;
                            showToast("Viagem atualizada com sucesso!", "success");
                        } else {
                            // Add new travel
                            const { error: insertError } = await supabase
                                .from('travels')
                                .insert([payload]);
                            if (insertError) throw insertError;
                            showToast("Viagem adicionada com sucesso!", "success");
                        }

                        setNewTravel({ date: '', plate: '', km: '', branch_id: '' });
                        setEditingTravel(null);
                        fetchData();
                    } catch (e) {
                        console.error("Erro ao salvar viagem:", e);
                        setError(`Erro ao salvar viagem: ${e.message}`);
                        showToast("Erro ao salvar viagem.", "error");
                    } finally {
                        setIsLoading(false);
                    }
                };

                const confirmDeleteTravel = (travel) => {
                    setTravelToDelete(travel);
                    setShowConfirmModal(true);
                };

                const handleDeleteTravel = async () => {
                    if (!travelToDelete) return;
                    setIsLoading(true);
                    setShowConfirmModal(false); // Close modal
                    try {
                        const { error: deleteError } = await supabase
                            .from('travels')
                            .delete()
                            .eq('id', travelToDelete.id);
                        if (deleteError) throw deleteError;
                        showToast("Viagem exclu√≠da com sucesso!", "success");
                        fetchData();
                    } catch (e) {
                        console.error("Erro ao deletar viagem:", e);
                        setError("Erro ao deletar viagem.");
                        showToast("Erro ao excluir viagem.", "error");
                    } finally {
                        setIsLoading(false);
                        setTravelToDelete(null);
                    }
                };

                const handleEditClick = (travel) => {
                    setNewTravel({
                        date: travel.date,
                        plate: travel.plate,
                        km: travel.km.toString(),
                        branch_id: travel.branch_id
                    });
                    setEditingTravel(travel);
                };

                const handleCancelEdit = () => {
                    setNewTravel({ date: '', plate: '', km: '', branch_id: '' });
                    setEditingTravel(null);
                    setError(null);
                };

                return (
                    React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg" },
                        React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-4 text-center" }, "Cadastro de KM/Viagens"),
                        error && (
                            React.createElement('div', { className: "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4", role: "alert" },
                                React.createElement('strong', { className: "font-bold" }, "Erro:"),
                                React.createElement('span', { className: "block sm:inline" }, " ", error)
                            )
                        ),
                        React.createElement('form', { onSubmit: handleAddOrUpdateTravel, className: "grid grid-cols-1 md:grid-cols-5 gap-4 mb-6 items-end" },
                            React.createElement('div', null,
                                React.createElement('label', { htmlFor: "travel-date", className: "block text-sm font-medium text-gray-700 mb-1" }, "Data"),
                                React.createElement('input', {
                                    type: "date",
                                    id: "travel-date",
                                    value: newTravel.date,
                                    onChange: (e) => setNewTravel({ ...newTravel, date: e.target.value }),
                                    className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                                    required: true,
                                    disabled: isLoading
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { htmlFor: "travel-plate", className: "block text-sm font-medium text-gray-700 mb-1" }, "Placa do Equipamento"),
                                React.createElement('div', { className: "relative" },
                                    React.createElement('select', {
                                        id: "travel-plate",
                                        value: newTravel.plate,
                                        onChange: (e) => setNewTravel({ ...newTravel, plate: e.target.value }),
                                        className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm pr-10 transition duration-150 ease-in-out",
                                        required: true,
                                        disabled: isLoading
                                    },
                                        React.createElement('option', { value: "" }, "Selecione a Placa"),
                                        equipments.map(eq => (
                                            React.createElement('option', { key: eq.id, value: eq.plate }, eq.plate)
                                        ))
                                    ),
                                    React.createElement(LucideIcon, { name: "ChevronDown", className: "absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none" })
                                )
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { htmlFor: "travel-km", className: "block text-sm font-medium text-gray-700 mb-1" }, "KM"),
                                React.createElement('input', {
                                    type: "number",
                                    id: "travel-km",
                                    value: newTravel.km,
                                    onChange: (e) => setNewTravel({ ...newTravel, km: e.target.value }),
                                    className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                                    placeholder: "KM",
                                    step: "0.01",
                                    required: true,
                                    disabled: isLoading
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { htmlFor: "travel-branch", className: "block text-sm font-medium text-gray-700 mb-1" }, "Filial"),
                                React.createElement('div', { className: "relative" },
                                    React.createElement('select', {
                                        id: "travel-branch",
                                        value: newTravel.branch_id,
                                        onChange: (e) => setNewTravel({ ...newTravel, branch_id: e.target.value }),
                                        className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm pr-10 transition duration-150 ease-in-out",
                                        required: true,
                                        disabled: isLoading
                                    },
                                        React.createElement('option', { value: "" }, "Selecione a Filial"),
                                        branches.map(branch => (
                                            React.createElement('option', { key: branch.id, value: branch.id }, branch.name)
                                        ))
                                    ),
                                    React.createElement(LucideIcon, { name: "ChevronDown", className: "absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none" })
                                )
                            ),
                            React.createElement('div', { className: "flex space-x-2 md:col-span-1" },
                                React.createElement('button', {
                                    type: "submit",
                                    className: `inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white ${editingTravel ? 'bg-orange-500 hover:bg-orange-600 focus:ring-orange-500' : 'bg-blue-600 hover:bg-blue-700 focus:ring-blue-500'} focus:outline-none focus:ring-2 focus:ring-offset-2 transition duration-150 ease-in-out transform hover:scale-105`,
                                    disabled: isLoading
                                },
                                    isLoading ? (
                                        React.createElement('svg', { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" },
                                            React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r="10", stroke: "currentColor", strokeWidth="4" }),
                                            React.createElement('path', { className: "opacity-75", fill: "currentColor", d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
                                        )
                                    ) : (
                                        React.createElement(LucideIcon, { name: editingTravel ? "FileText" : "PlusCircle", className: "mr-2 h-5 w-5" })
                                    ),
                                    editingTravel ? 'Atualizar' : 'Adicionar Viagem'
                                ),
                                editingTravel && React.createElement('button', {
                                    type: "button",
                                    onClick: handleCancelEdit,
                                    className: "inline-flex items-center justify-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
                                    disabled: isLoading
                                }, "Cancelar")
                            )
                        ),
                        React.createElement('div', { className: "overflow-x-auto rounded-lg shadow-md border border-gray-200" },
                            React.createElement('table', { className: "min-w-full divide-y divide-gray-200" },
                                React.createElement('thead', { className: "bg-gray-100" },
                                    React.createElement('tr', null,
                                        React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Data"),
                                        React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Placa"),
                                        React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Tipo Equipamento"),
                                        React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "KM"),
                                        React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Filial"),
                                        React.createElement('th', { scope: "col", className: "px-6 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider" }, "A√ß√µes")
                                    )
                                ),
                                React.createElement('tbody', { className: "bg-white divide-y divide-gray-200" },
                                    isLoading && travels.length === 0 ? (
                                        React.createElement('tr', null,
                                            React.createElement('td', { colSpan: "6", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Carregando viagens...")
                                        )
                                    ) : travels.length === 0 ? (
                                        React.createElement('tr', null,
                                            React.createElement('td', { colSpan: "6", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Nenhuma viagem cadastrada.")
                                        )
                                    ) : (
                                        travels.map((travel) => (
                                            React.createElement('tr', { key: travel.id, className: "hover:bg-gray-50 transition-colors duration-150" },
                                                React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" }, travel.date),
                                                React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" }, travel.plate),
                                                React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" }, travel.equipamentos.type),
                                                React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" }, travel.km),
                                                React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" }, travel.filiais.name),
                                                React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-right text-sm font-medium" },
                                                    React.createElement('button', { onClick: () => handleEditClick(travel), className: "text-blue-600 hover:text-blue-800 transition-colors duration-150", title: "Editar Viagem", disabled: isLoading },
                                                        React.createElement(LucideIcon, { name: "FileText", className: "h-5 w-5" })
                                                    ),
                                                    React.createElement('button', { onClick: () => confirmDeleteTravel(travel), className: "text-red-600 hover:text-red-800 ml-4 transition-colors duration-150", title: "Excluir Viagem", disabled: isLoading },
                                                        React.createElement(LucideIcon, { name: "Trash2", className: "h-5 w-5" })
                                                    )
                                                )
                                            )
                                        ))
                                    )
                                )
                            )
                        ),
                        showConfirmModal && React.createElement(ConfirmationModal, { message: `Tem certeza que deseja excluir o registro de viagem de ${travelToDelete?.km} KM da placa "${travelToDelete?.plate}"?`,
                        onConfirm: handleDeleteTravel, onCancel: () => setShowConfirmModal(false) })
                    )
                );
            }

            // const PlantManagement = ({ userId, showToast }) => {
            //   const [newPlantName, setNewPlantName] = React.useState('');
            //   const [plants, setPlants] = React.useState([]);
            //   const [error, setError] = React.useState(null);
            //   const [isLoading, setIsLoading] = React.useState(false);
            //   const [showConfirmModal, setShowConfirmModal] = React.useState(false);
            //   const [plantToDelete, setPlantToDelete] = React.useState(null);

            //   React.useEffect(() => {
            //     if (!userId) return;
            //     const fetchPlants = async () => {
            //       setIsLoading(true);
            //       const { data, error: fetchError } = await supabase
            //         .from('usinas')
            //         .select('*')
            //         .eq('created_by_username', userId)
            //         .order('created_at', { ascending: false });

            //       if (fetchError) {
            //         console.error("Erro ao buscar usinas no Supabase:", fetchError);
            //         setError("Erro ao carregar usinas. Por favor, recarregue a p√°gina.");
            //         showToast("Erro ao carregar usinas.", "error");
            //       } else {
            //         setPlants(data);
            //         setError(null);
            //       }
            //       setIsLoading(false);
            //     };
            //     fetchPlants();
            //   }, [userId, showToast]);

            //   const handleAddPlant = async (e) => {
            //     e.preventDefault();
            //     if (!newPlantName.trim()) {
            //       setError("O nome da usina n√£o pode estar vazio.");
            //       showToast("O nome da usina n√£o pode estar vazio.", "error");
            //       return;
            //     }
            //     setIsLoading(true);
            //     try {
            //       const { error: insertError } = await supabase
            //         .from('usinas')
            //         .insert([
            //           { name: newPlantName.trim(), created_by_username: userId }
            //         ]);

            //       if (insertError) throw insertError;

            //       setNewPlantName('');
            //       setError(null);
            //       showToast("Usina adicionada com sucesso!", "success");
            //       const { data, error: fetchError } = await supabase
            //         .from('usinas')
            //         .select('*')
            //         .eq('created_by_username', userId)
            //         .order('created_at', { ascending: false });
            //       if (fetchError) console.error("Erro ao re-buscar usinas:", fetchError);
            //       else setPlants(data);

            //     } catch (e) {
            //       console.error("Erro ao adicionar usina:", e);
            //       setError("Erro ao adicionar usina. Tente novamente.");
            //       showToast("Erro ao adicionar usina.", "error");
            //     }
            //     setIsLoading(false);
            //   };

            //   const confirmDeletePlant = (plant) => {
            //     setPlantToDelete(plant);
            //     setShowConfirmModal(true);
            //   };

            //   const handleDeletePlant = async () => {
            //     if (!plantToDelete) return;
            //     setIsLoading(true);
            //     setShowConfirmModal(false);
            //     try {
            //       const { error: deleteError } = await supabase
            //         .from('usinas')
            //         .delete()
            //         .eq('id', plantToDelete.id);

            //       if (deleteError) throw deleteError;

            //       showToast("Usina exclu√≠da com sucesso!", "success");
            //       const { data, error: fetchError } = await supabase
            //         .from('usinas')
            //         .select('*')
            //         .eq('created_by_username', userId)
            //         .order('created_at', { ascending: false });
            //       if (fetchError) console.error("Erro ao re-buscar usinas:", fetchError);
            //       else setPlants(data);

            //     } catch (e) {
            //       console.error("Erro ao deletar usina:", e);
            //       setError("Erro ao deletar usina. Tente novamente.");
            //       showToast("Erro ao excluir usina.", "error");
            //     } finally {
            //         setIsLoading(false);
            //         setPlantToDelete(null);
            //     }
            //   };

            //   return (
            //     React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg" },
            //       React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-4 text-center" }, "Cadastro de Usinas"),
            //       error && (
            //         React.createElement('div', { className: "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4", role: "alert" },
            //           React.createElement('strong', { className: "font-bold" }, "Erro:"),
            //           React.createElement('span', { className: "block sm:inline" }, " ", error)
            //         )
            //       ),
            //       React.createElement('form', { onSubmit: handleAddPlant, className: "flex flex-col sm:flex-row gap-4 mb-6" },
            //         React.createElement('input', {
            //           type: "text",
            //           value: newPlantName,
            //           onChange: (e) => setNewPlantName(e.target.value),
            //           className: "flex-grow mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
            //           placeholder: "Nome da nova usina",
            //           required: true,
            //           disabled: isLoading
            //         }),
            //         React.createElement('button', {
            //           type: "submit",
            //           className: "inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
            //           disabled: isLoading
            //         },
            //         isLoading ? (
            //             React.createElement('svg', { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" },
            //               React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r="10", stroke: "currentColor", strokeWidth="4" }),
            //               React.createElement('path', { className: "opacity-75", fill: "currentColor", d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
            //             )
            //           ) : (
            //             React.createElement(LucideIcon, { name: "PlusCircle", className: "mr-2 h-5 w-5" })
            //           ),
            //           isLoading ? 'Adicionando...' : 'Adicionar Usina'
            //         )
            //       ),
            //       React.createElement('div', { className: "overflow-x-auto rounded-lg shadow-md border border-gray-200" },
            //         React.createElement('table', { className: "min-w-full divide-y divide-gray-200" },
            //           React.createElement('thead', { className: "bg-gray-100" },
            //             React.createElement('tr', null,
            //               React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Usina"),
            //               React.createElement('th', { scope: "col", className: "px-6 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider" }, "A√ß√µes")
            //             )
            //           ),
            //           React.createElement('tbody', { className: "bg-white divide-y divide-gray-200" },
            //             isLoading && plants.length === 0 ? (
            //               React.createElement('tr', null,
            //                 React.createElement('td', { colSpan: "2", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Carregando usinas...")
            //               )
            //             ) : plants.length === 0 ? (
            //               React.createElement('tr', null,
            //                 React.createElement('td', { colSpan: "2", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Nenhuma usina cadastrada.")
            //               )
            //             ) : (
            //               plants.map((plant) => (
            //                 React.createElement('tr', { key: plant.id, className: "hover:bg-gray-50 transition-colors duration-150" },
            //                   React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" }, plant.name),
            //                   React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-right text-sm font-medium" },
            //                     React.createElement('button', { onClick: () => confirmDeletePlant(plant), className: "text-red-600 hover:text-red-800 ml-4 transition-colors duration-150", title: "Excluir Usina", disabled: isLoading },
            //                       React.createElement(LucideIcon, { name: "Trash2", className: "h-5 w-5" })
            //                     )
            //                   )
            //                 )
            //               ))
            //             )
            //           )
            //         )
            //       ),
            //       showConfirmModal && React.createElement(ConfirmationModal, { message: `Tem certeza que deseja excluir a usina "${plantToDelete?.name}"?`,
            //       onConfirm: handleDeletePlant, onCancel: () => setShowConfirmModal(false) })
            //     )
            //   );
            // };


            // Main App Component
            function App() {
                const [userRole, setUserRole] = React.useState(null);
                const [userId, setUserId] = React.useState(null); // State to store userId
                const [currentView, setCurrentView] = React.useState('dashboard');
                const [toast, setToast] = React.useState(null);
                const [isSidebarOpen, setIsSidebarOpen] = React.useState(false);

                const showToast = (message, type) => {
                    setToast({ message, type });
                };

                const closeToast = () => {
                    setToast(null);
                };

                const handleLogin = (role, username) => {
                    setUserRole(role);
                    setUserId(username); // Set userId on login
                    setCurrentView('dashboard'); // Redirect to dashboard after login
                };

                const handleLogout = () => {
                    setUserRole(null);
                    setUserId(null);
                    setCurrentView('login'); // Redirect to login page
                };

                const toggleSidebar = () => {
                    setIsSidebarOpen(!isSidebarOpen);
                };

                const sidebarItems = [
                    { name: 'Dashboard', icon: 'LayoutDashboard', view: 'dashboard', roles: ['administrador', 'usuario'] },
                    { name: 'Filiais', icon: 'MapPin', view: 'branches', roles: ['administrador'] },
                    { name: 'Equipamentos', icon: 'Truck', view: 'equipment', roles: ['administrador'] },
                    //{ name: 'Usinas', icon: 'Factory', view: 'usinas', roles: ['administrador'] },
                    { name: 'KM/Viagens', icon: 'CalendarDays', view: 'travels', roles: ['administrador', 'usuario'] },
                    { name: 'Usu√°rios', icon: 'Users', view: 'users', roles: ['administrador'] },
                ];

                const renderView = () => {
                    switch (currentView) {
                        case 'dashboard':
                            return React.createElement('div', { className: "p-6 bg-white rounded-xl shadow-lg text-center" },
                                React.createElement('h2', { className: "text-3xl font-bold text-gray-800 mb-4" }, "Bem-vindo ao Placa App!"),
                                React.createElement('p', { className: "text-gray-600" }, "Selecione uma op√ß√£o no menu lateral para come√ßar.")
                            );
                        case 'branches':
                            return React.createElement(BranchManagement, { userId: userId, showToast: showToast });
                        case 'equipment':
                            return React.createElement(EquipmentManagement, { userId: userId, showToast: showToast });
                        // case 'usinas':
                        //     return React.createElement(PlantManagement, { userId: userId, showToast: showToast });
                        case 'travels':
                            return React.createElement(TravelManagement, { userId: userId, showToast: showToast });
                        case 'users':
                            return React.createElement(UserManagement, { showToast: showToast });
                        default:
                            return React.createElement('div', { className: "p-6 bg-white rounded-xl shadow-lg" },
                                React.createElement('h2', { className: "text-2xl font-bold text-red-600" }, "Erro 404"),
                                React.createElement('p', null, "P√°gina n√£o encontrada.")
                            );
                    }
                };

                if (!userRole) {
                    return React.createElement(LoginPage, { onLogin: handleLogin });
                }

                return (
                    React.createElement('div', { className: "flex min-h-screen bg-gray-100" },
                        // Sidebar
                        React.createElement('div', { className: `fixed inset-y-0 left-0 bg-gray-800 text-white w-64 p-5 space-y-6 z-40 transform ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'} md:relative md:translate-x-0 transition duration-300 ease-in-out` },
                            React.createElement('div', { className: "flex items-center justify-between" },
                                React.createElement('h1', { className: "text-2xl font-semibold" }, "Placa App"),
                                React.createElement('button', { onClick: toggleSidebar, className: "md:hidden text-gray-400 hover:text-white" },
                                    React.createElement(LucideIcon, { name: "X", className: "h-6 w-6" })
                                )
                            ),
                            React.createElement('nav', null,
                                sidebarItems.map(item => (
                                    (item.roles.includes(userRole)) &&
                                    React.createElement('a', {
                                        key: item.view,
                                        href: "#",
                                        onClick: () => { setCurrentView(item.view); setIsSidebarOpen(false); },
                                        className: `flex items-center space-x-3 p-3 rounded-lg transition-colors duration-200 ${currentView === item.view ? 'bg-blue-600 text-white shadow-md' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}`
                                    },
                                        React.createElement(LucideIcon, { name: item.icon, className: "h-5 w-5" }),
                                        React.createElement('span', null, item.name)
                                    )
                                ))
                            ),
                            React.createElement('div', { className: "absolute bottom-5 left-5" },
                                React.createElement('button', {
                                    onClick: handleLogout,
                                    className: "flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:bg-gray-700 hover:text-white transition-colors duration-200 w-full"
                                },
                                    React.createElement(LucideIcon, { name: "LogOut", className: "h-5 w-5" }),
                                    React.createElement('span', null, "Sair")
                                )
                            )
                        ),

                        // Main Content
                        React.createElement('div', { className: "flex-1 flex flex-col overflow-hidden" },
                            // Top Bar for mobile
                            React.createElement('div', { className: "bg-white p-4 flex items-center justify-between shadow-md md:hidden" },
                                React.createElement('button', { onClick: toggleSidebar, className: "text-gray-600 hover:text-gray-800" },
                                    React.createElement(LucideIcon, { name: "Menu", className: "h-6 w-6" })
                                ),
                                React.createElement('h2', { className: "text-lg font-semibold text-gray-800" }, "Placa App"),
                                React.createElement('div', { className: "w-6 h-6" }) // Placeholder for spacing
                            ),
                            React.createElement('main', { className: "flex-1 overflow-x-hidden overflow-y-auto p-4 md:p-6" },
                                renderView()
                            )
                        ),
                        toast && React.createElement(Toast, { message: toast.message, type: toast.type, onClose: closeToast })
                    )
                );
            };
        };
    </script>
</body>
</html>
